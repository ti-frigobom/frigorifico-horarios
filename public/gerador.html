<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gerador de Card - Frigobom</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        .bg-gold { background: linear-gradient(45deg, #d4af37, #f1d592); }
        .text-gold { color: #d4af37; }
        #card-export { width: 450px; background: white; border: 2px solid #d4af37; }
    </style>
</head>
<body class="bg-slate-100 p-8 flex flex-col lg:flex-row justify-center items-start gap-10">

    <div class="bg-white p-6 rounded-xl shadow-lg w-full max-w-md border-t-4 border-red-600">
        <h2 class="text-xl font-bold mb-4 uppercase">Ajustar Mensagem</h2>
        <textarea id="msgInput" rows="6" class="w-full border p-3 rounded text-sm mb-4" oninput="document.getElementById('preview-msg').innerText = this.value">
Passando para comunicar hor√°rio de produ√ß√£o.

Lembrando do caf√© da manh√£ de cada setor: todos os setores tomam caf√© na primeira paradinha.

Havendo qualquer altera√ß√£o comunicarei voc√™s.</textarea>
        
        <button onclick="baixarCard()" class="w-full bg-black text-white py-4 rounded-lg font-black shadow-lg hover:bg-gray-800 transition">
            üì• BAIXAR CARD (.JPG)
        </button>
        <p class="text-xs text-center text-gray-400 mt-4">Sua sess√£o expira em 5 min de inatividade.</p>
    </div>

    <div id="card-export">
        <div class="bg-black p-6 text-center">
            <img src="logo.png" class="h-32 mx-auto mb-2">
        </div>
        
        <div class="bg-red-700 text-white py-2 text-center font-black uppercase tracking-widest italic">
            Comunicado de Produ√ß√£o
        </div>

        <div class="p-6">
            <p id="preview-data" class="text-center font-bold text-2xl text-slate-900 border-b-2 border-gold pb-2 mb-6 uppercase italic">
                CARREGANDO DATA...
            </p>

            <div id="setores-lista" class="space-y-3 mb-6 text-lg">
                </div>

            <div class="bg-slate-50 p-4 border-l-4 border-gold">
                <p id="preview-msg" class="text-slate-800 text-sm leading-relaxed whitespace-pre-line">
                    Passando para comunicar hor√°rio de produ√ß√£o.

                    Lembrando do caf√© da manh√£ de cada setor: todos os setores tomam caf√© na primeira paradinha.
                    
                    Havendo qualquer altera√ß√£o comunicarei voc√™s.
                </p>
            </div>
        </div>

        <div class="bg-black text-gold text-[10px] p-2 text-center font-bold tracking-[0.3em] uppercase">
            Alimentando Gera√ß√µes
        </div>
    </div>

    <script>
        async function carregarDados() {
            // Busca Data
            const resData = await fetch('/api/config/data');
            const dataCfg = await resData.json();
            if(dataCfg.valor) {
                const d = new Date(dataCfg.valor + "T00:00:00");
                document.getElementById('preview-data').innerText = d.toLocaleDateString('pt-BR', { weekday: 'long', day: '2-digit', month: '2-digit' });
            }

            // Busca Setores
            const resSet = await fetch('/api/setores');
            const setores = await resSet.json();
            document.getElementById('setores-lista').innerHTML = setores.map(s => `
                <div class="flex justify-between border-b border-slate-100 pb-1 font-bold">
                    <span class="uppercase text-slate-700">${s.nome}</span>
                    <span class="text-red-700 font-mono">${s.horario}</span>
                </div>
            `).join('');
        }

        function baixarCard() {
            html2canvas(document.getElementById('card-export'), { scale: 3 }).then(canvas => {
                const link = document.createElement('a');
                link.download = `FRIGOBOM_PRODUCAO.jpg`;
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.click();
            });
        }

        carregarDados();
        // Inatividade
        let timer = setTimeout(() => window.location.href = '/login.html', 300000);
        document.onmousemove = () => { clearTimeout(timer); timer = setTimeout(() => window.location.href = '/login.html', 300000); };
    </script>
</body>
</html>