<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gerador de Card Profissional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        .text-gold { color: #d4af37; }
        .bg-gold { background-color: #d4af37; }
        .border-gold { border-color: #d4af37; }
        
        #card-export {
            width: 450px;
            background-color: #fff;
            border: 2px solid #d4af37;
            position: relative;
        }
        .header-main { background-color: #000; padding: 20px; text-align: center; }
        .banner-vermelho { background-color: #b91c1c; color: white; padding: 10px; text-align: center; font-weight: 900; text-transform: uppercase; }
    </style>
</head>
<body class="bg-slate-100 p-4 md:p-10 flex flex-col lg:flex-row gap-10 justify-center items-start">

    <div class="bg-white p-6 rounded-xl shadow-xl w-full max-w-md border-t-4 border-red-600">
        <h2 class="text-2xl font-bold mb-6 text-slate-800">Configura√ß√£o do Card</h2>
        
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-bold text-slate-600 mb-1">Logo do Frigor√≠fico:</label>
                <input type="file" id="logoInput" accept="image/*" class="w-full text-sm border p-2 rounded" onchange="previewLogo(event)">
            </div>

            <div>
                <label class="block text-sm font-bold text-slate-600 mb-1">Data da Produ√ß√£o:</label>
                <input type="date" id="dataInput" class="w-full border p-2 rounded" oninput="atualizarPreview()">
            </div>

            <div>
                <label class="block text-sm font-bold text-slate-600 mb-1">Texto de Rodap√©:</label>
                <textarea id="msgInput" rows="4" class="w-full border p-2 rounded text-sm" oninput="atualizarPreview()">
Lembrando do caf√© da manh√£ de cada setor: todos os setores tomam caf√© na primeira paradinha.

Havendo qualquer altera√ß√£o comunicarei voc√™s.</textarea>
            </div>

            <button onclick="baixarCard()" class="w-full bg-red-600 hover:bg-red-700 text-white py-4 rounded-lg font-black shadow-lg transition-all flex justify-center items-center gap-2">
                <span>üì• BAIXAR PARA WHATSAPP</span>
            </button>
        </div>
    </div>

    <div id="card-export" class="shadow-2xl">
        <div class="header-main">
            <img id="logo-preview" src="" class="max-h-24 mx-auto mb-2 hidden">
            <div id="placeholder-logo" class="h-16 flex items-center justify-center border-2 border-dashed border-gray-600 text-gray-500 text-xs uppercase">
                Sua Logo Aparecer√° Aqui
            </div>
        </div>

        <div class="banner-vermelho tracking-widest text-lg">
            Comunicado de Produ√ß√£o
        </div>

        <div class="p-6">
            <p id="preview-data" class="text-center font-bold text-slate-900 text-xl mb-6 border-b-2 border-gold pb-2 uppercase italic">
                Selecione uma data
            </p>

            <div id="setores-preview" class="grid grid-cols-1 gap-2 mb-6">
                </div>

            <div class="bg-slate-50 p-4 border-l-4 border-gold rounded">
                <p id="preview-msg" class="text-slate-700 text-sm leading-relaxed whitespace-pre-line">
                    Lembrando do caf√© da manh√£ de cada setor: todos os setores tomam caf√© na primeira paradinha.
                </p>
            </div>
        </div>

        <div class="bg-black p-3 text-center">
            <span class="text-gold font-bold text-[10px] tracking-[0.2em] uppercase">Excel√™ncia e Qualidade ‚Ä¢ 2026</span>
        </div>
    </div>

    <script>
        // Fun√ß√£o para carregar os setores salvos no banco
        async function carregarSetores() {
            const res = await fetch('/api/setores');
            const setores = await res.json();
            const container = document.getElementById('setores-preview');
            
            container.innerHTML = setores.map(s => `
                <div class="flex justify-between items-center bg-white border-b border-slate-100 py-1">
                    <span class="font-bold text-slate-800 text-sm uppercase">${s.nome}</span>
                    <span class="text-red-700 font-mono font-black text-base">${s.horario}</span>
                </div>
            `).join('');
        }

        // Fun√ß√£o para processar a logo
        function previewLogo(event) {
            const reader = new FileReader();
            reader.onload = function() {
                const output = document.getElementById('logo-preview');
                const placeholder = document.getElementById('placeholder-logo');
                output.src = reader.result;
                output.classList.remove('hidden');
                placeholder.classList.add('hidden');
            };
            reader.readAsDataURL(event.target.files[0]);
        }

        // Atualiza os textos em tempo real
        function atualizarPreview() {
            const data = document.getElementById('dataInput').value;
            const msg = document.getElementById('msgInput').value;
            
            if(data) {
                const dateObj = new Date(data);
                dateObj.setMinutes(dateObj.getMinutes() + dateObj.getTimezoneOffset());
                const formatada = dateObj.toLocaleDateString('pt-BR', { weekday: 'long', day: '2-digit', month: '2-digit' });
                document.getElementById('preview-data').innerText = formatada;
            }
            document.getElementById('preview-msg').innerText = msg;
        }

        // Gera a imagem final
        function baixarCard() {
            const card = document.getElementById('card-export');
            const btn = document.querySelector('button');
            btn.innerText = "‚è≥ GERANDO...";

            html2canvas(card, { 
                scale: 3, // Alta qualidade
                useCORS: true,
                backgroundColor: "#ffffff"
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `COMUNICADO_${new Date().getTime()}.jpg`;
                link.href = canvas.toDataURL('image/jpeg', 1.0);
                link.click();
                btn.innerHTML = "<span>üì• BAIXAR PARA WHATSAPP</span>";
            });
        }

        carregarSetores();
    </script>
</body>
</html>