<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Produção - Frigobom</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #020617; color: white; height: 100vh; display: flex; flex-direction: column; overflow: hidden; font-family: sans-serif; }
        .card-normal { background: #1e293b; border-top: 10px solid #22c55e; }
        .card-atencao { background: #450a0a; border-top: 10px solid #ef4444; animation: pulse 2s infinite; }
        .card-futuro { background: #0f172a; border-top: 10px solid #3b82f6; opacity: 0.8; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }
    </style>
</head>
<body>
    <header class="py-10 bg-slate-900 border-b border-slate-800 shadow-2xl text-center">
        <h1 id="titulo" class="text-6xl font-black uppercase tracking-tighter text-white">HORÁRIOS DA PRODUÇÃO</h1>
    </header>

    <div id="grid-setores" class="p-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 flex-grow items-start overflow-y-auto"></div>

    <footer class="bg-slate-900 p-6 flex justify-center gap-12 border-t border-slate-800">
        <div class="flex items-center gap-3"><div class="w-8 h-8 bg-green-500 rounded"></div><span class="font-black uppercase italic text-slate-300 text-xl">Em Operação</span></div>
        <div class="flex items-center gap-3"><div class="w-8 h-8 bg-blue-500 rounded"></div><span class="font-black uppercase italic text-slate-300 text-xl">Programado</span></div>
        <div class="flex items-center gap-3"><div class="w-8 h-8 bg-red-500 rounded"></div><span class="font-black uppercase italic text-slate-300 text-xl">Encerrado</span></div>
    </footer>

    <script>
        async function atualizar() {
            try {
                const resData = await fetch('/api/config/data');
                const dataCfg = await resData.json();
                const resSetores = await fetch('/api/setores');
                const setores = await resSetores.json();

                const hoje = new Date(); hoje.setHours(0,0,0,0);
                const dataBanc = dataCfg.valor ? new Date(dataCfg.valor + "T00:00:00") : hoje;
                
                document.getElementById('titulo').innerText = `HORÁRIOS DA PRODUÇÃO - ${dataBanc.toLocaleDateString('pt-BR')}`;

                document.getElementById('grid-setores').innerHTML = setores.map(s => {
                    let status = 'normal';
                    const [hInicio, hFim] = s.horario.split('-').map(h => h.trim());

                    if (dataBanc > hoje) status = 'futuro';
                    else if (dataBanc < hoje) status = 'atencao';
                    else {
                        if(hFim) {
                            const [h, m] = hFim.split(':').map(Number);
                            if ((new Date().getHours()*60 + new Date().getMinutes()) >= (h*60 + m)) status = 'atencao';
                        }
                    }

                    const cores = { normal: 'card-normal', atencao: 'card-atencao', futuro: 'card-futuro' };
                    const textos = { normal: '', atencao: 'ENCERRADO', futuro: 'AGENDADO' };

                    return `
                    <div class="${cores[status]} p-6 rounded-3xl flex flex-col items-center justify-between shadow-2xl min-h-[300px]">
                        <span class="text-white font-black text-4xl uppercase mb-6 text-center leading-tight w-full border-b border-slate-700 pb-4">${s.nome}</span>
                        
                        <div class="grid grid-cols-2 gap-8 w-full text-center">
                            <div>
                                <p class="text-slate-400 text-xs font-black uppercase mb-1 tracking-widest">Início</p>
                                <p class="text-5xl font-mono font-black text-yellow-400">${hInicio || '--:--'}</p>
                            </div>
                            <div>
                                <p class="text-slate-400 text-xs font-black uppercase mb-1 tracking-widest">Término</p>
                                <p class="text-5xl font-mono font-black text-yellow-400">${hFim || '--:--'}</p>
                            </div>
                        </div>

                        <div class="h-8 mt-6">
                            ${textos[status] ? `<span class="bg-white/10 px-4 py-1 rounded-full font-black text-sm tracking-widest text-white">${textos[status]}</span>` : ''}
                        </div>
                    </div>`;
                }).join('');
            } catch (e) { console.error("Erro ao atualizar TV:", e); }
        }
        atualizar(); 
        setInterval(atualizar, 900000); // 15 minutos
    </script>
</body>
</html>