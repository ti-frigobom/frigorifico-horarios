<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel de Produção</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #020617; color: white; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .card-normal { background: #1e293b; border-left: 15px solid #22c55e; }
        .card-atencao { background: #450a0a; border-left: 15px solid #ef4444; animation: pulse 2s infinite; }
        .card-futuro { background: #0f172a; border-left: 15px solid #3b82f6; opacity: 0.8; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
    </style>
</head>
<body>
    <header class="py-8 bg-slate-900 border-b border-slate-800 shadow-2xl text-center">
        <h1 id="titulo" class="text-5xl font-black uppercase tracking-tighter">HORÁRIOS DA PRODUÇÃO</h1>
    </header>

    <div id="grid-setores" class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 flex-grow overflow-y-auto"></div>

    <footer class="bg-slate-900 p-6 flex justify-center gap-10 border-t border-slate-800">
        <div class="flex items-center gap-2"><div class="w-6 h-6 bg-green-500"></div><span class="font-bold uppercase italic text-slate-400">Em Operação</span></div>
        <div class="flex items-center gap-2"><div class="w-6 h-6 bg-blue-500"></div><span class="font-bold uppercase italic text-slate-400">Programado</span></div>
        <div class="flex items-center gap-2"><div class="w-6 h-6 bg-red-500"></div><span class="font-bold uppercase italic text-slate-400">Encerrado</span></div>
    </footer>

    <script>
        async function atualizar() {
            const resData = await fetch('/api/config/data');
            const dataCfg = await resData.json();
            const resSetores = await fetch('/api/setores');
            const setores = await resSetores.json();

            // Lógica de Data
            const hoje = new Date(); hoje.setHours(0,0,0,0);
            const dataBanc = dataCfg.valor ? new Date(dataCfg.valor + "T00:00:00") : hoje;
            
            document.getElementById('titulo').innerText = `HORÁRIOS DA PRODUÇÃO - ${dataBanc.toLocaleDateString('pt-BR')}`;

            document.getElementById('grid-setores').innerHTML = setores.map(s => {
                let status = 'normal';
                if (dataBanc > hoje) status = 'futuro';
                else if (dataBanc < hoje) status = 'atencao';
                else {
                    const fim = s.horario.split('-')[1]?.trim();
                    if(fim) {
                        const [h, m] = fim.split(':').map(Number);
                        if ((new Date().getHours()*60 + new Date().getMinutes()) >= (h*60 + m)) status = 'atencao';
                    }
                }

                const cores = { normal: 'card-normal', atencao: 'card-atencao', futuro: 'card-futuro' };
                const textos = { normal: '', atencao: 'ENCERRADO', futuro: 'AGENDADO' };

                return `<div class="${cores[status]} p-8 rounded-2xl flex flex-col items-center justify-center shadow-xl">
                    <span class="text-slate-400 font-black text-2xl uppercase mb-2">${s.nome}</span>
                    <span class="text-6xl font-mono font-black text-yellow-400">${s.horario}</span>
                    <span class="mt-4 font-black text-red-400">${textos[status]}</span>
                </div>`;
            }).join('');
        }
        atualizar(); setInterval(atualizar, 900000); // 15 min
    </script>
</body>
</html>