<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Produção</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            background-color: #020617; 
            color: white; 
            height: 100vh; 
            margin: 0; 
            overflow: hidden; /* Evita barra de rolagem na TV */
            display: flex;
            flex-direction: column;
        }

        /* Card Normal: Verde suave para não cansar a vista */
        .card-normal { 
            background: #1e293b; 
            border-left: 12px solid #22c55e; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }

        /* Card Atenção: Vermelho vibrante com animação de pulso */
        .card-atencao { 
            background: #450a0a; 
            border-left: 12px solid #ef4444; 
            animation: pulse 2s infinite;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* Grid Inteligente: Se ajusta sozinho à quantidade de setores */
        #grid-setores {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 15px;
            padding: 20px;
            flex-grow: 1; /* Faz o grid ocupar o espaço entre o título e a legenda */
            align-content: start;
        }
    </style>
</head>
<body>

    <header class="py-6 bg-slate-900 border-b border-slate-800 shadow-2xl">
        <h1 class="text-5xl md:text-6xl font-black text-center uppercase tracking-tighter text-white">
            HORÁRIOS DA PRODUÇÃO
        </h1>
    </header>

    <div id="grid-setores">
        </div>

    <footer class="bg-slate-900 p-4 border-t border-slate-800 flex justify-center gap-10">
        <div class="flex items-center gap-3">
            <div class="w-6 h-6 bg-green-500 rounded"></div>
            <span class="text-xl font-bold uppercase text-slate-300 italic">Em Operação</span>
        </div>
        <div class="flex items-center gap-3">
            <div class="w-6 h-6 bg-red-500 rounded"></div>
            <span class="text-xl font-bold uppercase text-slate-300 italic">Turno Encerrado / Atenção</span>
        </div>
    </footer>

    <script>
        function verificarAtenção(horarioString) {
            try {
                // Formato esperado: "07:00 - 17:00"
                const partes = horarioString.split('-');
                if(partes.length < 2) return false;

                const horaFimStr = partes[1].trim(); 
                const [horasFim, minutosFim] = horaFimStr.split(':').map(Number);

                const agora = new Date();
                const totalMinutosFim = (horasFim * 60) + minutosFim;
                const totalMinutosAgora = (agora.getHours() * 60) + agora.getMinutes();

                return totalMinutosAgora >= totalMinutosFim;
            } catch (e) { return false; }
        }

        async function carregarHorarios() {
            try {
                const res = await fetch('/api/setores');
                const setores = await res.json();
                const container = document.getElementById('grid-setores');
                
                container.innerHTML = setores.map(s => {
                    const atencao = verificarAtenção(s.horario);
                    const classeCard = atencao ? 'card-atencao' : 'card-normal';
                    
                    return `
                        <div class="${classeCard} p-6 rounded-xl flex flex-col justify-center items-center h-full">
                            <span class="text-slate-400 uppercase text-2xl font-black mb-2 text-center leading-tight">
                                ${s.nome}
                            </span>
                            <span class="text-5xl md:text-6xl font-mono font-black text-yellow-400 drop-shadow-lg">
                                ${s.horario}
                            </span>
                            ${atencao ? '<span class="text-red-400 text-sm font-black mt-3 animate-bounce">ALERTA: FIM DE TURNO</span>' : ''}
                        </div>
                    `;
                }).join('');
            } catch (err) {
                console.error("Erro ao carregar dados:", err);
            }
        }

        // Atualiza os dados a cada 30 segundos
        carregarHorarios();
        setInterval(carregarHorarios, 30000); 

        // Recarrega a página inteira a cada 1 hora para evitar travamentos do navegador da TV
        setTimeout(() => window.location.reload(), 3600000);
    </script>
</body>
</html>